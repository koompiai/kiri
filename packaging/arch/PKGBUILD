# Maintainer: KOOMPI <dev@koompi.com>
pkgname=kiri
pkgver=0.1.0
pkgrel=1
pkgdesc="Kiri â€” voice-to-text assistant powered by OpenVINO Whisper"
arch=('x86_64')
url="https://github.com/koompi/kiri"
license=('MIT')
depends=('python>=3.12' 'gtk4' 'libadwaita' 'alsa-lib')
makedepends=('uv')
source=("$pkgname-$pkgver.tar.gz")
sha256sums=('SKIP')

package() {
    cd "$srcdir/$pkgname-$pkgver"

    # Install source to /opt/kiri
    install -dm755 "$pkgdir/opt/$pkgname"
    cp -r . "$pkgdir/opt/$pkgname/"

    # Create venv with uv
    cd "$pkgdir/opt/$pkgname"
    uv sync --no-dev

    # Wrapper scripts
    install -dm755 "$pkgdir/usr/bin"

    cat > "$pkgdir/usr/bin/kiri" << 'EOF'
#!/bin/sh
exec /opt/kiri/.venv/bin/kiri "$@"
EOF
    chmod 755 "$pkgdir/usr/bin/kiri"

    cat > "$pkgdir/usr/bin/kiri-popup" << 'EOF'
#!/bin/sh
exec /opt/kiri/.venv/bin/kiri-popup "$@"
EOF
    chmod 755 "$pkgdir/usr/bin/kiri-popup"

    # Desktop file
    install -Dm644 "$srcdir/$pkgname-$pkgver/packaging/kiri.desktop" \
        "$pkgdir/usr/share/applications/kiri.desktop"
}
